language: cpp

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
    - os: osx
      osx_image: xcode7.2

branches:
  only:
    - master

cache:
  apt: true
  directories:
    - ${HOME}/installed

env:
  - CAFFE_COMMIT_HASH=25422de79f58e214e55834524bfe696f8651889f

install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo -H bash ./script/install_dependencies_linux.sh; fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]  ; then bash ./script/install_dependencies_mac.sh          ; fi

script:
  - mkdir build
  - cd build
  - cmake -DTEST_ON=true -DUSE_CAFFE=true -DUSE_GIE=false -DUSE_MXNET=false -DUSE_FP16=false -DCPU_ONLY=true ..
  - make -j4
  - make -j4 test